

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="积极向上好青年">
  <meta name="keywords" content="">
  
    <meta name="description" content="分布式理论CAP分布式系统不可能同时满足一致性、可用性和分区容忍性，最多只能满足其中的两项  Consistency一致性：指的是多个副本能否保持一致；对某个数据进行更新后，如果所有用户都能读取到最新的值，那么认为该系统具有强一致性  Availability可用性：系统在面对各种异常时可以提供正常服务的能力，&#x3D; 系统可用时间 &#x2F; 总时间，4 个 9 的可用性表示系统 99">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据面试总结">
<meta property="og:url" content="http://zhangchaozc.cn/2021/01/24/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="积极向上好青年">
<meta property="og:description" content="分布式理论CAP分布式系统不可能同时满足一致性、可用性和分区容忍性，最多只能满足其中的两项  Consistency一致性：指的是多个副本能否保持一致；对某个数据进行更新后，如果所有用户都能读取到最新的值，那么认为该系统具有强一致性  Availability可用性：系统在面对各种异常时可以提供正常服务的能力，&#x3D; 系统可用时间 &#x2F; 总时间，4 个 9 的可用性表示系统 99">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22879930/1653114741379-0a3f9138-107e-452e-a38d-14833856f930.png#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u53391230&margin=%5Bobject%20Object%5D&name=Hadoop%E7%94%9F%E6%80%81.png&originHeight=716&originWidth=1076&originalType=binary&ratio=1&rotation=0&showTitle=false&size=212658&status=done&style=none&taskId=u72ccfe53-fd03-4ef2-9672-3034006aa35&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/svg/22879930/1653114773290-02e943fc-c2b7-49d6-b052-e533bb0eb7a3.svg#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&height=421&id=u792f9a06&margin=%5Bobject%20Object%5D&name=Flink%E6%9E%B6%E6%9E%84.svg&originHeight=613&originWidth=851&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78238&status=done&style=none&taskId=u6ff9c5d4-4542-4345-a652-a80984615e4&title=&width=584">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/svg/22879930/1653114817284-38d7d6c3-0fe8-4d39-9dc4-074ca3d4d308.svg#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u37bf7c00&margin=%5Bobject%20Object%5D&name=checkpoint%E6%9C%BA%E5%88%B6.svg&originHeight=200&originWidth=553&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15460&status=done&style=none&taskId=u7db3b7ec-a05b-48ff-a453-cd80865346f&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22879930/1653114862184-99a607b1-41a0-44c7-b6e0-41646b573291.png#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&height=265&id=udb886aef&margin=%5Bobject%20Object%5D&name=kafka%E6%9E%B6%E6%9E%84%E5%9B%BE.png&originHeight=376&originWidth=819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=214381&status=done&style=none&taskId=uda7c8c21-e03e-472c-9dd6-8df394680cd&title=&width=578">
<meta property="article:published_time" content="2021-01-24T03:23:09.000Z">
<meta property="article:modified_time" content="2022-05-27T17:38:17.496Z">
<meta property="article:author" content="积极向上好青年">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="校招">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/22879930/1653114741379-0a3f9138-107e-452e-a38d-14833856f930.png#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u53391230&margin=%5Bobject%20Object%5D&name=Hadoop%E7%94%9F%E6%80%81.png&originHeight=716&originWidth=1076&originalType=binary&ratio=1&rotation=0&showTitle=false&size=212658&status=done&style=none&taskId=u72ccfe53-fd03-4ef2-9672-3034006aa35&title=">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>大数据面试总结 - 积极向上好青年</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"zhangchaozc.cn","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>积极向上好青年</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://s3.bmp.ovh/imgs/2022/05/24/2e670aaebc54c655.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="大数据面试总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-01-24 11:23" pubdate>
          2021年1月24日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          13k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          110 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">大数据面试总结</h1>
            
            <div class="markdown-body">
              
              <meta name="referrer" content="no-referrer" />

<h1 id="分布式理论"><a href="#分布式理论" class="headerlink" title="分布式理论"></a>分布式理论</h1><h2 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h2><p>分布式系统不可能同时满足一致性、可用性和分区容忍性，最多只能满足其中的两项</p>
<ul>
<li><p>Consistency一致性：指的是多个副本能否保持一致；对某个数据进行更新后，如果所有用户都能读取到最新的值，那么认为该系统具有强一致性</p>
</li>
<li><p>Availability可用性：系统在面对各种异常时可以提供正常服务的能力，&#x3D; 系统可用时间 &#x2F; 总时间，4 个 9 的可用性表示系统 99.99% 的时间是可用的</p>
</li>
<li><p>网络分区指分布式系统中的节点被划分为多个区域，每个区域内部可以通信，但是区域之间无法通信</p>
<h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><p>远程过程调用。<br>两个不同的进程，一个如何调用另一个的函数？基于socket的网络传输，将需要调用的类，方法，参数通过socket传输到另一个进程上。通过反射机制生成实例，再调用函数</p>
<h1 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h1><p>Hadoop生态<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22879930/1653114741379-0a3f9138-107e-452e-a38d-14833856f930.png#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u53391230&margin=%5Bobject%20Object%5D&name=Hadoop%E7%94%9F%E6%80%81.png&originHeight=716&originWidth=1076&originalType=binary&ratio=1&rotation=0&showTitle=false&size=212658&status=done&style=none&taskId=u72ccfe53-fd03-4ef2-9672-3034006aa35&title=" srcset="/img/loading.gif" lazyload alt="Hadoop生态.png"></p>
<h2 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h2><p>主从结构，只有一个NameNode，有很多DataNode<br>NameNode：接收用户的操作请求；维护文件系统的目录结构；管理文件与block之间的关系，block与DataNode之间的关系；存储元数据，元数据保存在内存中<br>DataNode：文件被分为block存储在磁盘上，有多个副本；存储文件内容，保存在磁盘中<br>NameNode的离线备份：SecondaryNameNode<br>文件切分为块，默认大小每个版本不一样，可配置；副本数量默认为3，可配置<br>DataNode通过心跳机制（周期为3秒，可配置）和NameNode进行联系，除了发送心跳包以外，还发一些信息等<br>分布式文件系统：</p>
</li>
<li><p>通透性，让用户看起来就是像访问磁盘一样</p>
</li>
<li><p>容错性，某个节点的宕机不影响整个系统的运作</p>
</li>
</ul>
<p>在Hadoop中，有一个文件系统的抽象，它提供了文件系统实现的各类接口，HDFS只是这个抽象文件系统的一个实例：org.apache.hadoop.fs.FileSystem<br>心跳每3秒一次，如果超过10分钟没有收到某个DataNode 的心跳，则认为该节点不可用。伴随DataNode的心跳，还发送有块报告，包含datanode上所有数据块的列表。NameNode回复心跳，也伴随着相关指令等<br>特点：</p>
<ul>
<li>适合处理大文件，不适合处理小文件</li>
<li>不适合处理低延迟数据访问，适合离线任务</li>
<li>设计原则是“一次写入，多次读取”，因此不适合存储修改频繁的文件</li>
</ul>
<p>常用命令：<br>hadoop fs -ls &#x2F; ：列出所有文件<br>hadoop fs -put ：将本地文件上传到HDFS<br>hadoop fs -get ：将HDFS的文件下载到本地</p>
<h3 id="读写文件流程？"><a href="#读写文件流程？" class="headerlink" title="读写文件流程？"></a>读写文件流程？</h3><ul>
<li>写文件</li>
</ul>
<ol>
<li>请求先到文件系统，写<strong>操作日志</strong></li>
<li>文件系统向<strong>NameNode发出RPC调用</strong>，创建文件。NameNode进行权限认证；文件系统新建FSDataOutputStream来处理通信</li>
<li>FSDataOutputStream把文件分包，放入数据队列；数据队列由DataStreamer处理，为数据包挑选合适的datanode，被选中的datanode和数据包之间形成管道pipeline</li>
<li>通过流的方式，把数据送过去；同时也维护一个ack队列，用来确认包是否都送达</li>
<li>全部送完后，客户通知文件写入完毕</li>
</ol>
<ul>
<li>读文件</li>
</ul>
<ol>
<li>通过文件系统打开文件</li>
<li>文件系统通过RPC请求namenode，确定文件在哪个块上</li>
<li>找到后新建FSDataInputStream开始读数据</li>
<li>先读完第一个块，随后读取其它的块，直到全部读完</li>
</ol>
<h2 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h2><p>JobTracker：接收计算任务；将任务分给TaskTrackers执行；监控执行情况TaskTracker：执行任务<br>实现map()和reduce()两个函数，即可实现分布式计算；无需考虑分布式计算的底层细节如：网络通信、任务分发、任务调度等<br>map任务：</p>
<ol>
<li>读取文件内容，解析成key-value对，每一个键值对调用一次map函数</li>
<li>写map函数，对key-value进行处理，转化为新的key-value输出</li>
<li>对key-value分区，对不同key排序分组（可选）</li>
</ol>
<p>reduce任务：</p>
<ol>
<li>通过网络获取map的key-value对，将相同key的数据group起来</li>
<li>写reduce函数，将输入的key-value对转化成新的key-value输出</li>
</ol>
<p>入门基础例子：WordCount文件：<br>hadoop hdfs<br>hadoop spark<br>hadoop mapreduce<br>map:输入：(k,”hadoop hdfs”) &#x3D;&gt; (“hadoop”,1)，k为行号所在的字符偏移<br>reduce：输入：(“hadoop”,list(1,1,1)) &#x3D;&gt; (“hadoop”,3) &#x3D;&gt; 写文件</p>
<h3 id="combine方法"><a href="#combine方法" class="headerlink" title="combine方法"></a>combine方法</h3><p>在reduce之前先在本地先combine一下，减少reduce的数。某些情况下combine函数和自己写的mapper函数是一样的</p>
<h3 id="partition方法"><a href="#partition方法" class="headerlink" title="partition方法"></a>partition方法</h3><p>根据key来分区，也就是输出分文件输出</p>
<h4 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h4><p>MapReduce的输入被分为很多InputSplit，每个InputSplit是输入的其中一块数据，每个Mapper处理一个InputSplit；每个InputSplit被分为多条record，每个record产生一个key-value对<br>流程：</p>
<ul>
<li>当客户端运行一个Job时，客户端调用getSplits方法，将InputSplit列表发送给jobTracker</li>
<li>map task会将split传递给recordReader</li>
<li>recordReader会一次读取一条记录，产生key-value传递给map方法</li>
<li>map里面的run方法会不停的调用nextKeyValue()</li>
<li>通过上下文对象调用recordReader中的同名方法</li>
<li>context.getCurrentKey()和context.getCurrentValue()调用都会委托给recordReader中的同名方法</li>
</ul>
<p>默认的输入类是TextInputFormat，默认读一行数据，还有其它的输入类：</p>
<ul>
<li>NLineInputFormat</li>
<li>BinaryInputFormat</li>
<li>DBInputFormat</li>
<li>等</li>
</ul>
<p>同理，输出默认为TextOutputFormat，也有其它的输出类</p>
<h4 id="数据倾斜？"><a href="#数据倾斜？" class="headerlink" title="数据倾斜？"></a>数据倾斜？</h4><p>数据倾斜指的是大量相同的Key被partition分配到同一个分区中，导致一个节点很忙碌，而其它节点很闲；使得总体的效率非常低下<br>解决办法</p>
<ul>
<li>增加JVM内存（治标不治本）</li>
<li>增加Reduce的个数（还是没有根本的解决问题）</li>
<li>自定义分区，自己写一个partition类用来分区（可取）</li>
<li>重新设计Key，在map阶段给Key加一个随机数，reduce阶段再去掉（可用）</li>
<li>使用combinner合并，combinner是在map阶段、reduce之前的一个中间阶段，在这个阶段可以选择性的把大量的相同key数据先进行一个合并，减轻reduce的工作（可用）<h3 id="MR的Shuffle和Spark的Shuffle"><a href="#MR的Shuffle和Spark的Shuffle" class="headerlink" title="MR的Shuffle和Spark的Shuffle"></a>MR的Shuffle和Spark的Shuffle</h3><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ba2c67897fc1">https://www.jianshu.com/p/ba2c67897fc1</a><br>从Map端输出K-V，到Reduce端接收K-V，整个中间的过程可以称之为Shuffle；Shuffle分为两个部分：<br>Map端：</li>
</ul>
<ol>
<li>在map task执行时，它的输入数据来源于HDFS的block，假设map的输入数据都是像”aaa”这样的字符串</li>
<li>key是”aaa”， value是数值1；假设现在有3个reducer，key交给哪个去处理？默认对key hash后再以reduce task数量取模，从而确定；当然，有提供Partitioner接口，可以自定义这个逻辑</li>
<li>key与value值都会被序列化成字节数组写入到Map端缓冲区，缓冲区是为了减少对磁盘的IO操作；然而，缓冲区的大小默认是100M，当缓冲区快满（达到了80%）的时候，数据会被写入磁盘中的临时文件（这个过程叫做Spill）</li>
<li>溢写前会对数据进行排序，如果客户端设置了combine函数，会把相同的key做个累加，以减少溢写到文件中的K-V数量</li>
<li>多次溢写会产生多个临时文件，包括最后一次执行的缓冲区，会产生若干文件；需要将所有文件合并到一起，这个过程就叫做Merge。对于”aaa”就是像这样的：{“aaa”, [5, 8, 2, …]}</li>
</ol>
<p>Reduce端：将Map端的文件拉取过来，作为输入文件</p>
<h1 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h1><p>引入背景：hadoop1.0中，JobTracker负载太重（既要负责任务的管理，也要负责任务的计算），而且存在单点故障，一旦故障，所有执行的任务全部失败；扩展性差，不支持MR以外的计算；<br>根本思想：根本的思想是将JobTracker两个主要的功能分离成单独的组件，这两个功能是资源管理和任务调度、监控<br>基本架构：<br>ResourceManager：处理请求；启动和监控ApplicationMaster；资源的分配与调度<br>NodeManager：单个节点上的资源管理；处理ResourceManager和ApplicationMaster的命令<br>ApplicationMaster：数据切分；为应用程序申请资源；分配任务、任务监控</p>
<h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><h2 id="Flink架构"><a href="#Flink架构" class="headerlink" title="Flink架构"></a>Flink架构</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/svg/22879930/1653114773290-02e943fc-c2b7-49d6-b052-e533bb0eb7a3.svg#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&height=421&id=u792f9a06&margin=%5Bobject%20Object%5D&name=Flink%E6%9E%B6%E6%9E%84.svg&originHeight=613&originWidth=851&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78238&status=done&style=none&taskId=u6ff9c5d4-4542-4345-a652-a80984615e4&title=&width=584" srcset="/img/loading.gif" lazyload alt="Flink架构.svg"><br>典型的主从结构：</p>
<ul>
<li>JobManager，管理者，提供：</li>
</ul>
<p><strong>ResourceManager</strong> ：负责 Flink 集群中的资源提供、回收、分配 - 它管理 <strong>task slots</strong><br>Flink 为不同的环境和资源提供者（例如 YARN、Mesos、Kubernetes 和 standalone 部署）实现了对应的 ResourceManager<br><strong>Dispatcher</strong> ： 提供了一个 REST 接口，用来提交 Flink 应用程序执行，并为每个提交的作业启动一个新的 JobMaster<br><strong>JobMaster</strong> ： 负责集群的管理，包括：</p>
<ul>
<li>资源管理</li>
<li>Job调度和安排</li>
<li>Checkpoint管理</li>
<li>JobGraph，执行图管理</li>
</ul>
<p><strong>TaskManager</strong>：负责资源的提供<br>资源调度的最小单位是 task _slot_。TaskManager 中 task slot 的数量表示并发处理 task 的数量。请注意一个 task slot 中可以执行多个算子<br>每个 worker（TaskManager）都是一个 <em>JVM 进程</em><br>注意：slot 是资源管理的最小单位，是有多个线程的</p>
<ul>
<li>Shuffle管理。<strong>Shuffle本质是数据在不同的节点中，传输和交换的过程</strong><h2 id="Flink和Spark-Streaming区别？"><a href="#Flink和Spark-Streaming区别？" class="headerlink" title="Flink和Spark Streaming区别？"></a>Flink和Spark Streaming区别？</h2>设计理念不一样，Spark主要是批处理，它认为流是一种特殊的批次。Spark Streaming 是微批处理，运行的时候需要指定批处理的时间，每次运行 job 时处理一个批次的数据<br>Flink主要是流处理，当然也可以进行批处理（认为批是一种特殊的流）。更适合处理流数据，支持多种时间：事件时间、处理时间<h2 id="为什么是Flink？"><a href="#为什么是Flink？" class="headerlink" title="为什么是Flink？"></a>为什么是Flink？</h2>Apache Flink是一个面向分布式数据流处理和批量数据处理的开源计算平台，提供支持<strong>流处理</strong>和<strong>批处理</strong>两种类型应用的功能<br>Flink是完全支持流处理，当处理流数据时，数据被定义为是无界的；而批处理作为一种特殊的流处理，输入数据流被定义为有界的<br>从目前来看，有状态的流计算架构模式，只有Flink满足。具体优势有以下几点：</li>
</ul>
<ol>
<li>同时支持高吞吐、低延迟、高性能</li>
<li>支持事件时间的概念。使用事件产生的时间，基于事件驱动的机制，即使事件乱序到达，流系统也能保证计算出正确的结果</li>
<li>支持有状态的计算</li>
<li>支持高灵活的窗口操作。在流数据处理中，数据是连续不断的，需要通过串口的方式对流数据进行一定范围的聚合计算</li>
<li>基于轻量级的分布式快照，主要是容错，当系统发生故障时，能够快速的从快照中恢复</li>
</ol>
<p>应用场景：<br>（1） 实时智能推荐（满足对时延的要求）<br>（2） 复杂事件处理<br>（3） 实时欺诈检测<br>（4） 实时数仓与ETL<br>（5） 流数据分析<br>（6） 实时报表分析</p>
<h2 id="水位和时间？"><a href="#水位和时间？" class="headerlink" title="水位和时间？"></a>水位和时间？</h2><p>时间概念，是处理时间还是事件时间？以前直接设置<br>env.setStreamTimeCharacteristic();<br>现在最新版本已经废弃了，现在直接指定时间就好了assignTimestampsAndWatermarks<br>用到什么时间，就指定就好了。比如说你用的对象，里面有时间字段，直接指定这个字段为时间就行<br>水位：<br>最新的版本叫做水位策略，数据是流，源源不断的到来，这是一个不确定的东西。水位就是要把不确定变为确定，现在的版本直接指定延迟时间就行了forBoundedOutOfOrderness。当前数据来了之后，携带一个水位信息，比如延迟2秒，当前是第10秒的数据来了，携带的水位是8，会告诉系统8秒以前的数据都到齐了<br>可以看它的代码实现：<br>就是当前emitWatermark等于当前最大的事件时间减去延迟减1<br>在上游有多个输入的流，当前水位取最小的</p>
<h2 id="什么是有状态的流计算？"><a href="#什么是有状态的流计算？" class="headerlink" title="什么是有状态的流计算？"></a>什么是有状态的流计算？</h2><p>两个概念：状态和状态后端<br>Flink提供了以下几种状态：<br>ValueState<T> getState(ValueStateDescriptor<T>)<br>ReducingState<T> getReducingState(ReducingStateDescriptor<T>)<br>ListState<T> getListState(ListStateDescriptor<T>)<br>AggregatingState&lt;IN, OUT&gt; getAggregatingState(AggregatingStateDescriptor&lt;IN, ACC, OUT&gt;)<br>MapState&lt;UK, UV&gt; getMapState(MapStateDescriptor&lt;UK, UV&gt;)<br>状态后端：<br>可以指定这些变量的状态后端，Flink支持三种：</p>
<ul>
<li>MemoryStateBackend ，堆内存，较小，用于<strong>本地调试</strong></li>
<li>FsStateBackend ，堆内存，受制于GC</li>
<li>RocksDBStateBackend ，本地磁盘，慢10倍</li>
</ul>
<p>当你对这些变量进行操作时，在算子内，这些变量具有<strong>全局可见性</strong>（为什么可以保存上一次的计算结果）<br>这是一种用法<br>另外，当checkpoint到来时（内存屏障），系统会把这些变量dump到本地的文件系统中。（需要你在yaml配置文件中配置checkpoint、savepoint的地址，比如HDFS的地址）<br>以便重启任务可以恢复状态<br>怎么做的：<br>FromElementsFunction的实现，一个有状态的计算<br>一般的做法，就是屏障来的时候，把内存变量放到state中。程序启动时再从state恢复到内存中</p>
<h2 id="Checkpoint机制？"><a href="#Checkpoint机制？" class="headerlink" title="Checkpoint机制？"></a>Checkpoint机制？</h2><p>内存屏障：<br><img src="https://cdn.nlark.com/yuque/0/2022/svg/22879930/1653114817284-38d7d6c3-0fe8-4d39-9dc4-074ca3d4d308.svg#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u37bf7c00&margin=%5Bobject%20Object%5D&name=checkpoint%E6%9C%BA%E5%88%B6.svg&originHeight=200&originWidth=553&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15460&status=done&style=none&taskId=u7db3b7ec-a05b-48ff-a453-cd80865346f&title=" srcset="/img/loading.gif" lazyload alt="checkpoint机制.svg"><br>如果开启checkpoint，流数据会被插入checkpoint屏障，根据你配置的间隔时间插入<br>当checkpoint屏障来的时候，做一些操作，比如：存状态变量等<br>当一个屏障，从source、transform、sink流出，一次checkpoint就结束了<br>上代码：<br>FlinkKafkaConsumer的实现：<br>@Public<br>public interface CheckpointedFunction {<br>&#x2F;**<br>checkpoint 到来时，会调用这个函数<br>*&#x2F;<br>void snapshotState(FunctionSnapshotContext context) throws Exception;</p>
<pre><code class="hljs">/**
程序初始化的时候，启动的时候，如果开启了 checkpoint，会调用这个函数
 */
void initializeState(FunctionInitializationContext context) throws Exception;
</code></pre>
<p>}</p>
<p>@Public<br>public interface CheckpointListener {<br>&#x2F;**<br>当一次 checkpoint 完成之后，会调用这个函数<br>*&#x2F;<br>void notifyCheckpointComplete(long checkpointId) throws Exception;</p>
<p>default void notifyCheckpointAborted(long checkpointId) throws Exception {}<br>}</p>
<h2 id="Checkpoint和Savepoint的区别？"><a href="#Checkpoint和Savepoint的区别？" class="headerlink" title="Checkpoint和Savepoint的区别？"></a>Checkpoint和Savepoint的区别？</h2><p>官方文档的一句话，checkpoint相当于MySQL的操作日志，savepoint相当于MySQL的备份<br>都是保存数据，对整体和对局部，手动触发和自动触发的区别</p>
<h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><h2 id="为什么使用MQ？优缺点？"><a href="#为什么使用MQ？优缺点？" class="headerlink" title="为什么使用MQ？优缺点？"></a>为什么使用MQ？优缺点？</h2><p>无非是三个关键字：</p>
<ul>
<li>异步</li>
<li>削峰</li>
<li>解耦</li>
</ul>
<p>异步：<br>对于后台系统，用户一个请求可能需要做很多事情（对接各种系统），用户等待的时间太长了。把消息放队列中，然后再慢慢的去做<br>对于大数据：<br>解耦：<br>总线模块和计算模块分开。数据源只关注有无Kafka，计算的输出可以当做下次计算的输入<br>削峰：<br>数据量峰值很大，也不会引起下游入库的宕机。有消息队列在，慢慢写</p>
<p><strong>缺点：</strong><br>所有的系统，都依赖它。保证MQ是高可用的。系统维护度、复杂度会变高<br><strong>常用的MQ：</strong></p>
<ul>
<li><p>10w级别的：Kafka，RocketMQ</p>
</li>
<li><p>1w级别的：ActiveMQ，RabbitMQ</p>
<h2 id="Kafka如何做到高可用？"><a href="#Kafka如何做到高可用？" class="headerlink" title="Kafka如何做到高可用？"></a>Kafka如何做到高可用？</h2><p>架构图：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22879930/1653114862184-99a607b1-41a0-44c7-b6e0-41646b573291.png#clientId=ua8a8020e-04b7-4&crop=0&crop=0&crop=1&crop=1&from=ui&height=265&id=udb886aef&margin=%5Bobject%20Object%5D&name=kafka%E6%9E%B6%E6%9E%84%E5%9B%BE.png&originHeight=376&originWidth=819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=214381&status=done&style=none&taskId=uda7c8c21-e03e-472c-9dd6-8df394680cd&title=&width=578" srcset="/img/loading.gif" lazyload alt="kafka架构图.png"></p>
</li>
<li><p>Kafka由多个broker组成（服务器，一个节点上可以有多个，每个都要配置端口和自己的日志目录）</p>
</li>
<li><p>创建一个topic，每个topic划分成多个partition分布在不同的broker上</p>
</li>
</ul>
<p>你可以指定topic有几个副本。假设有3副本，其中1个leader，两个follower<br><strong>写数据</strong>的时候，生产者就写 leader，然后 leader 将数据落地写本地磁盘，接着其他 follower 自己主动从 leader 来 pull 数据。一旦所有 follower 同步好数据了，就会发送 ack 给 leader，leader 收到所有 follower 的 ack 之后，就会返回写成功的消息给生产者。（当然，这只是其中一种模式，还可以适当调整这个行为）<br><strong>消费</strong>的时候，只会从 leader 去读，但是只有当一个消息已经被所有 follower 都同步成功返回 ack 的时候，这个消息才会被消费者读到<br>如果某台节点宕机，剩下的follower再选举出一个leader。用来接收读写请求。做到高可用</p>
<h2 id="Zookeeper有什么用？"><a href="#Zookeeper有什么用？" class="headerlink" title="Zookeeper有什么用？"></a>Zookeeper有什么用？</h2><p>一句话：负责集群的协调和稳定</p>
<ul>
<li>比如说一个节点宕机后的选取工作</li>
</ul>
<p>Kafka 使用 ZooKeeper ：</p>
<ul>
<li><p>存放集群元数据</p>
</li>
<li><p>成员管理</p>
</li>
<li><p>选举</p>
</li>
<li><p>消费状态，offset管理，消费组管理</p>
<h2 id="什么是消费组？"><a href="#什么是消费组？" class="headerlink" title="什么是消费组？"></a>什么是消费组？</h2><p>Kafka 中，消费者组是一个由多个消费者实例 构成的组。多个实例共同订阅若干个主题，实现<strong>共同消费</strong>。同一个组下的每个实例都配置有 相同的组 ID，被分配不同的订阅分区。当某个实例挂掉的时候，其他实例会自动地承担起 它负责消费的分区</p>
<h2 id="Kafka中offset的作用？怎么保证数据有序？"><a href="#Kafka中offset的作用？怎么保证数据有序？" class="headerlink" title="Kafka中offset的作用？怎么保证数据有序？"></a>Kafka中offset的作用？怎么保证数据有序？</h2><p>在 Kafka 中，每个 主题分区下的每条消息都被赋予了一个唯一的 ID 数值，用于标识它在分区中的位置。这个 ID 数值，就被称为位移，或者叫偏移量。一旦消息被写入到分区日志，它的位移值将不能 被修改<br>kafka每个partition中的消息在写入时都是有序的，消费时，<strong>每个partition只能被每一个group中的一个消费者消费，保证了消费时也是有序</strong>的。整个topic不保证有序。如果为了保证topic整个有序，那么将partition调整为1.<br>消费者提交消费位移时提交的是当前消费到的最新消息的offset+1</p>
<h2 id="为什么Kafka不支持读写分离？"><a href="#为什么Kafka不支持读写分离？" class="headerlink" title="为什么Kafka不支持读写分离？"></a>为什么Kafka不支持读写分离？</h2><p>在 Kafka 中，生产者写入消息、消费者读取消息的操作都是与 leader 副本进行交互的，从 而实现的是一种<strong>主写主读</strong>的生产消费模型</p>
</li>
<li><p>延时导致的数据一致性问题。同步需要时间，这个时候去读副本，可能是脏数据</p>
<h2 id="Kafka怎么保证数据不重复？"><a href="#Kafka怎么保证数据不重复？" class="headerlink" title="Kafka怎么保证数据不重复？"></a>Kafka怎么保证数据不重复？</h2><p>什么情况下数据会重复消费？数据被消费了，被处理了，但是还没有提交offset，这个时候挂了<br>再次重启消费，数据就重复了。怎么办？</p>
</li>
</ul>
<ol>
<li>数据的输出是否是幂等的，比如有主键，即使重复产生了数据，也不会写两次。因为会主键冲突，我们只要判断一下是否存在，存在则更新</li>
<li>双写数据库，比如已经消费的数据，另写一份到外部存储，比如Redis。每次只要判断Redis中是否有即可，这样不会保存重复的数据</li>
</ol>
<h2 id="Kafka怎么保证数据不丢？"><a href="#Kafka怎么保证数据不丢？" class="headerlink" title="Kafka怎么保证数据不丢？"></a>Kafka怎么保证数据不丢？</h2><p>常见的场景：</p>
<ol>
<li>数据还没处理完，offset自动提交了，在消费端数据丢了。解决办法：关闭Kafka的自动提交的策略，处理完数据后手动提交</li>
<li>在发送端丢了，数据发到leader，还没同步，系统挂了</li>
</ol>
<p>回复Ack：<br>分为两个，一是leader收到了，就认为成功发送；二是所有的副本都同步了，才认为数据成功发送。<br>设置ack&#x3D;all，副本都同步了，才算成功<br>此外：</p>
<ul>
<li><p>设置 replication.factor 参数：这个值必须大于 1，要求每个 partition 必须有至少 2 个副本</p>
</li>
<li><p>在 Kafka 服务端设置 min.insync.replicas 参数：这个值必须大于 1，这个是要求一个 leader 至少感知到有至少一个 follower 还跟自己保持联系，没掉队，这样才能确保 leader 挂了还有一个 follower 吧</p>
<h2 id="MQ消息过期？消息积压？怎么处理"><a href="#MQ消息过期？消息积压？怎么处理" class="headerlink" title="MQ消息过期？消息积压？怎么处理"></a>MQ消息过期？消息积压？怎么处理</h2><p>消息过期了，导致数据丢了？批量重导入，从业务数据再导入到MQ，补上<br>消息积压：</p>
</li>
<li><p>提高消费者的并行度，临时新建一个topic，扩partition为原来的10倍（可以支持并行度是原来的10倍）</p>
</li>
<li><p>把旧topic数据搬到新topic，再以10倍的速度进行消费</p>
<h1 id="场景题"><a href="#场景题" class="headerlink" title="场景题"></a>场景题</h1><p>进阶知识合集<br><a target="_blank" rel="noopener" href="https://github.com/doocs/advanced-java">进阶面试连环炮</a></p>
<h2 id="JVM调优问题"><a href="#JVM调优问题" class="headerlink" title="JVM调优问题"></a>JVM调优问题</h2><h3 id="基本的参数知识"><a href="#基本的参数知识" class="headerlink" title="基本的参数知识"></a>基本的参数知识</h3><p>JVM参数，标准参数：<br>java -help<br>java -server<br>java -client<br>java -version<br>java -help<br>java -help<br><strong>标准参数一般在各个版本中都是稳定不变的</strong><br>X参数，非标准化参数：<br>java -Xint：完全解释执行<br>java -Xcomp：第一次使用就编译成本地代码（完全编译执行）<br>java -Xmixed：混合模式，JVM自己来决定是否编译成本地代码<br>XX参数：<br>java -XX:[+-]<name>表示启用或者禁用某个属性</p>
<h1 id="例如"><a href="#例如" class="headerlink" title="例如"></a>例如</h1><p>java -XX:+UseG1GC 使用G1垃圾收集器</p>
<h1 id="kv对"><a href="#kv对" class="headerlink" title="kv对"></a>kv对</h1><p>java -XX:<name>&#x3D;<value> KV类型，设置Key-Value属性对</p>
<h1 id="常用，设置最大堆，最小堆"><a href="#常用，设置最大堆，最小堆" class="headerlink" title="常用，设置最大堆，最小堆"></a>常用，设置最大堆，最小堆</h1></li>
</ul>
<h1 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h1><p>-Xmx和-Xms：<br>-Xms等价于：-XX:InitialHeapSize，初始堆大小<br>-Xmx等价于：-XX:MaxHeapSize，最大堆大小</p>
<h3 id="查看当前的JVM参数"><a href="#查看当前的JVM参数" class="headerlink" title="查看当前的JVM参数"></a>查看当前的JVM参数</h3><p>直接打印出当前JVM的配置参数：</p>
<blockquote>
<p>java -XX:+PrintFlagsFinal &gt; D:&#x2F;jvm_param.txt<br>一部分内容：</p>
</blockquote>
<h1 id="x3D-代表就是默认值没有变-x3D-代表是修改过的值-intx-CICompilerCount-x3D-4-product-bool-CICompilerCountPerCPU-x3D-true-product-bool-CITime-x3D-false-product-bool-CMSAbortSemantics-x3D-false-product-uintx-CMSAbortablePrecleanMinWorkPerIteration-x3D-100-product-intx-CMSAbortablePrecleanWaitMillis-x3D-100-manageable-uintx-CMSBitMapYieldQuantum-x3D-10485760-product"><a href="#x3D-代表就是默认值没有变-x3D-代表是修改过的值-intx-CICompilerCount-x3D-4-product-bool-CICompilerCountPerCPU-x3D-true-product-bool-CITime-x3D-false-product-bool-CMSAbortSemantics-x3D-false-product-uintx-CMSAbortablePrecleanMinWorkPerIteration-x3D-100-product-intx-CMSAbortablePrecleanWaitMillis-x3D-100-manageable-uintx-CMSBitMapYieldQuantum-x3D-10485760-product" class="headerlink" title="&#x3D; 代表就是默认值没有变      # :&#x3D; 代表是修改过的值      intx CICompilerCount                          :&#x3D; 4                                   {product}      bool CICompilerCountPerCPU                     &#x3D; true                                {product}      bool CITime                                    &#x3D; false                               {product}      bool CMSAbortSemantics                         &#x3D; false                               {product}     uintx CMSAbortablePrecleanMinWorkPerIteration   &#x3D; 100                                 {product}      intx CMSAbortablePrecleanWaitMillis            &#x3D; 100                                 {manageable}     uintx CMSBitMapYieldQuantum                     &#x3D; 10485760                            {product}"></a>&#x3D; 代表就是默认值没有变      # :&#x3D; 代表是修改过的值      intx CICompilerCount                          :&#x3D; 4                                   {product}      bool CICompilerCountPerCPU                     &#x3D; true                                {product}      bool CITime                                    &#x3D; false                               {product}      bool CMSAbortSemantics                         &#x3D; false                               {product}     uintx CMSAbortablePrecleanMinWorkPerIteration   &#x3D; 100                                 {product}      intx CMSAbortablePrecleanWaitMillis            &#x3D; 100                                 {manageable}     uintx CMSBitMapYieldQuantum                     &#x3D; 10485760                            {product}</h1><p><strong>查看当前进程的JVM参数：</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"># <span class="hljs-number">1.</span> jps，找到 pid，假设为 <span class="hljs-number">16024</span> # <span class="hljs-number">2.</span> 查看堆内存大小，查看是否使用了 G1 jinfo -flag MaxHeapSize <span class="hljs-number">16024</span> # -XX:MaxHeapSize=<span class="hljs-number">4127195136</span> jinfo -flag UseG1GC <span class="hljs-number">16024</span> # -XX:-UseG1GC，- 减号代表没用<br></code></pre></td></tr></table></figure>
<h4 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h4><p>每 3 秒输出一次 GC 信息<br>C:\Users\zhangchao&gt;jstat -gc 16024 3000  S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT 10240.0 10240.0  0.0    0.0   63488.0   6382.3   167936.0     0.0     4480.0 770.2  384.0   75.9       0    0.000   0      0.000    0.000 10240.0 10240.0  0.0    0.0   63488.0   6382.3   167936.0     0.0     4480.0 770.2  384.0   75.9       0    0.000   0      0.000    0.000 10240.0 10240.0  0.0    0.0   63488.0   6382.3   167936.0     0.0     4480.0 770.2  384.0   75.9       0    0.000   0      0.000    0.000 # 显示堆中各区域大小，但是不太直观<br>每 3 秒输出一次 GC 信息（比例信息）<br>C:\Users\zhangchao&gt;jstat -gcutil 16024 3000   S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT   0.00   0.00  10.05   0.00  17.19  19.76      0    0.000     0    0.000    0.000   0.00   0.00  10.05   0.00  17.19  19.76      0    0.000     0    0.000    0.000   0.00   0.00  10.05   0.00  17.19  19.76      0    0.000     0    0.000    0.000   0.00   0.00  10.05   0.00  17.19  19.76      0    0.000     0    0.000    0.000   0.00   0.00  10.05   0.00  17.19  19.76      0    0.000     0    0.000    0.000   0.00   0.00  10.05   0.00  17.19  19.76      0    0.000     0    0.000    0.000<br>变量解释：<br>NGCMN：新生代最小容量 NGCMX：新生代最大容量 NGC：当前新生代容量 S0C：第一个幸存区大小 S1C：第二个幸存区的大小 OGCMN：老年代最小容量 OGCMX：老年代最大容量 OGC：当前老年代大小 OC:当前老年代大小 YGC：年轻代gc次数 FGC：老年代GC次数</p>
<h3 id="如何排查Java程序死锁？"><a href="#如何排查Java程序死锁？" class="headerlink" title="如何排查Java程序死锁？"></a>如何排查Java程序死锁？</h3><p>使用 jstack<br>C:\Users\zhangchao&gt;jps 11856 12804 Jps 17016 Launcher C:\Users\zhangchao&gt;jstack 17016 &gt; D:&#x2F;jstack.txt<br>内容：<br>“DestroyJavaVM” #14 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x0000000002d77800 nid&#x3D;0x27d4 waiting on condition [0x0000000000000000]    java.lang.Thread.State: RUNNABLE “JPS event loop” #11 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x0000000018871000 nid&#x3D;0x3ed4 runnable [0x0000000018d7e000]    java.lang.Thread.State: RUNNABLE 	at sun.nio.ch.WindowsSelectorImpl$SubSelector.poll0(Native Method) 	at sun.nio.ch.WindowsSelectorImpl$SubSelector.poll(WindowsSelectorImpl.java:296) 	at sun.nio.ch.WindowsSelectorImpl$SubSelector.access$400(WindowsSelectorImpl.java:278) 	at sun.nio.ch.WindowsSelectorImpl.doSelect(WindowsSelectorImpl.java:159) # 如果出现 DeadThread.run 说明死锁 # found deadlock，直接定位到死锁</p>
<h3 id="如何排查OOM问题？"><a href="#如何排查OOM问题？" class="headerlink" title="如何排查OOM问题？"></a>如何排查OOM问题？</h3><ul>
<li>让程序OOM的时候，自动dump出来</li>
</ul>
<p>-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;&#x2F;home&#x2F;work&#x2F;log&#x2F;dump</p>
<ul>
<li>手动通过 jmap 导出</li>
</ul>
<p>C:\Users\zhangchao&gt;jps 11856 12804 Jps 17016 Launcher C:\Users\zhangchao&gt;jmap -dump:format&#x3D;b,file&#x3D;D:&#x2F;heap.hprof 17016 Dumping heap to D:\heap.hprof … Heap dump file created<br>再用MAT工具分析，出分析报告<br>对象占比很大，一般都是溢出的位置</p>
<h3 id="如何GC调优？"><a href="#如何GC调优？" class="headerlink" title="如何GC调优？"></a>如何GC调优？</h3><p>打印GC日志：<br>-verbose:gc -XX:+PrintGCDetails –XX:+PrintGCTimeStamps –XX:+PrintGCDateStamps -Xloggc:$&#x2F;home&#x2F;logs&#x2F;gc.log<br>常用参数：<br>-Xms –Xmx ，初始堆和最大堆的大小 -XX:NewSize –XX:MaxNewSize ，新生代的大小、最大的新生代大小 -XX:NewRatio –XX:SurviorRatio ，新生代和老年代的比例，Sur和Eden的比例 -XX:MetaspaceSize –XX:MaxMetaspaceSize：元数据空间，最大元数据空间 -XX:+UseCompressedClassPointers，是否使用压缩的类型指针 -XX:CompressedClassSpaceSize ，压缩的类空间大小<br>GC分析工具：</p>
<ul>
<li>在线分析：<a target="_blank" rel="noopener" href="https://gceasy.io/">https://gceasy.io/</a></li>
<li>本地分析：GCView</li>
</ul>
<p>关注点：</p>
<ul>
<li>吞吐量，响应时间。可能造成系统卡顿的原因</li>
<li>GC Cause，造成GC的原因</li>
</ul>
<p>JVM调优就是根据日志分析结果，不断试错的过程<br>频繁GC的原因：</p>
<ul>
<li>循环创建对象</li>
<li>静态变量或其它存活期很长的变量，是否太大，占用太多空间</li>
<li>没有打开“空间分配担保”，导致Full GC<h2 id="SQL调优"><a href="#SQL调优" class="headerlink" title="SQL调优"></a>SQL调优</h2><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/62941196">一条SQL语句执行得很慢的原因有哪些</a><br>碰到这种，无非分类讨论：</li>
<li>其它的进程占用 CPU （使用 top 命令查看，确定系统资源） - 自己当前进程很慢 	- 偶尔很慢 		- 当前数据库正在同步数据 		- 其它 sql 语句锁表了，正好是你查询的表 	- 一直很慢，考虑优化 sql 语句</li>
</ul>
<ol>
<li>当我们要往数据库插入一条数据、或者要更新一条数据的时候，记录都会写入到 redo log 日记中去，等到空闲的时候，再把最新的数据同步到磁盘中去。日志同步导致 sql 查询慢</li>
<li>拿不到锁，刚好这条SQL涉及的表其它线程在用，我们拿不到锁</li>
<li>需要优化 sql</li>
</ol>
<h3 id="explain做语句分析"><a href="#explain做语句分析" class="headerlink" title="explain做语句分析"></a>explain做语句分析</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dennis211/article/details/78170079">mysql中explain的type的解释</a><br>通过explain做SQL调优，我们只关心三个字段：key：查找所用的索引rows：当前查找扫描的行数type：连接类型，常见的有六种连接类型all,index,range,ref,eq_ref,const，从左到右，效率是依次增强的，详细介绍：</p>
<ul>
<li>all，全表扫描，即使找到了，也要继续扫描着找，防止有多个值或者重复值</li>
<li>index也是全表扫描，只不过是按照索引的顺序；不一定比all强</li>
<li>range是范围扫描，除了显而易见的between，and以及’&gt;’,’&lt;’外，in和or也是索引范围扫描</li>
<li>ref：查找条件列使用了索引而且不为主键和unique</li>
<li>ref_eq：无重复，查询到一个就返回了</li>
<li>const，通常情况下，如果将一个主键放置到where后面作为条件查询，mysql优化器就能把这次查询优化转化为一个常量</li>
</ul>
<p>实例：<br>EXPLAIN SELECT <code>name</code>, <code>method</code> from website WHERE ip &#x3D; ‘127.0.0.1’;<br>分析结果：<br>key: null rows: 91749 type: ALL<br>给ip字段加上索引：<br>create index name001_index on website(ip)<br>再次分析：<br>key: name001_index，走了刚建的索引 rows: 25554,行数减少了 3 倍 type: ref，查询的时候用到了索引</p>
<h2 id="SQL题"><a href="#SQL题" class="headerlink" title="SQL题"></a>SQL题</h2><h3 id="查询各科成绩前三名"><a href="#查询各科成绩前三名" class="headerlink" title="查询各科成绩前三名"></a>查询各科成绩前三名</h3><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5d09e9046fb9a07f021a0499">https://juejin.im/post/5d09e9046fb9a07f021a0499</a></p>
<h2 id="如何处理高并发秒杀问题？"><a href="#如何处理高并发秒杀问题？" class="headerlink" title="如何处理高并发秒杀问题？"></a>如何处理高并发秒杀问题？</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liangkaiping0525/article/details/80836104">https://blog.csdn.net/liangkaiping0525/article/details/80836104</a><br>主要是两点：</p>
<ol>
<li>把请求拦截在系统的上游（不要落地到数据库中）</li>
<li>充分利用缓存（读多写少的请求）</li>
</ol>
<p>过滤掉一些重复请求：一个账户请求多次，一个IP反复请求的刷票；浏览器缓存，一个账户请求在浏览器中有记录的，你反复请求，JS不会让你发HTTP请求到服务器；即使你发上去了，服务器还有去重的操作<br>提前把余量读到缓存中，OK你要查询余量，直接查询缓存即可；不用读数据库做一个请求队列，来请求的线程排队，从缓冲中读入数据100余票，那么只放100个请求到数据库，其余的还在队列中，就让他直接返回（余票不足）</p>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/" class="category-chain-item">面试总结</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">#大数据</a>
      
        <a href="/tags/%E6%A0%A1%E6%8B%9B/">#校招</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>大数据面试总结</div>
      <div>http://zhangchaozc.cn/2021/01/24/面试总结/大数据面试总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>积极向上好青年</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年1月24日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/23/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/Java-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/" title="Java 面试总结">
                        <span class="hidden-mobile">Java 面试总结</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'http://zhangchaozc.cn/2021/01/24/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/';
          this.page.identifier = '/2021/01/24/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'fluid' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
